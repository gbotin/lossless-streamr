!function(){function a(a,b,c,d,e){this.fromSampleRate=a,this.toSampleRate=b,this.channels=0|c,this.outputBufferSize=d,this.noReturn=!!e,this.initialize()}var b;b=this;var c;c={};var d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};c.Base=function(){function a(){}var b;return b=/\b_super\b/,a.extend=function(a){var c,d,g,h,i,j;if(c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b}(this),"function"==typeof a){h=Object.keys(c.prototype),a.call(c,c),a={},i=c.prototype;for(g in i)d=i[g],f.call(h,g)<0&&(a[g]=d)}j=c.__super__;for(g in a)d=a[g],"function"==typeof d&&b.test(d)?!function(a,b){return c.prototype[a]=function(){var c,d;return d=this._super,this._super=j[a],c=b.apply(this,arguments),this._super=d,c}}(g,d):c.prototype[g]=d;return c},a}(),c.Buffer=function(){function a(a){this.data=a,this.length=this.data.length,this.next=null,this.prev=null}var d,e;return a.allocate=function(a){return new c.Buffer(new Uint8Array(a))},a.prototype.copy=function(){return new c.Buffer(new Uint8Array(this.data))},a.prototype.slice=function(a,b){return new c.Buffer(0===a&&b>=this.length?this.data:this.data.subarray(a,a+b))},d=b.BlobBuilder||b.MozBlobBuilder||b.WebKitBlobBuilder,e=b.URL||b.webkitURL||b.mozURL,a.makeBlob=function(a,b){var c;null==b&&(b="application/octet-stream");try{return new Blob([a],{type:b})}catch(e){}return null!=d?(c=new d,c.append(a),c.getBlob(b)):null},a.makeBlobURL=function(a,b){return null!=e?e.createObjectURL(this.makeBlob(a,b)):void 0},a.revokeBlobURL=function(a){return null!=e?e.revokeObjectURL(a):void 0},a.prototype.toBlob=function(){return a.makeBlob(this.data.buffer)},a.prototype.toBlobURL=function(){return a.makeBlobURL(this.data.buffer)},a}(),c.BufferList=function(){function a(){this.first=null,this.last=null,this.availableBytes=0,this.availableBuffers=0}return a.prototype.copy=function(){var a;return a=new c.BufferList,a.first=this.first,a.last=this.last,a.availableBytes=this.availableBytes,a.availableBuffers=this.availableBuffers,a},a.prototype.append=function(a){var b,c;return a.prev=this.last,null!=(b=this.last)&&(b.next=a),this.last=a,null==(c=this.first)&&(this.first=a),this.availableBytes+=a.length,this.availableBuffers++},a.prototype.advance=function(){return this.first?(this.availableBytes-=this.first.length,this.availableBuffers--,this.first=this.first.next):void 0},a.prototype.rewind=function(){var a;if(!this.first||this.first.prev)return this.first=(null!=(a=this.first)?a.prev:void 0)||this.last,this.first?(this.availableBytes+=this.first.length,this.availableBuffers++):void 0},a}();var d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c.Stream=function(){function a(a){this.list=a,this.localOffset=0,this.offset=0}var b,d,f,g,h,i,j,k,l,m,n,o,p;return b=new ArrayBuffer(16),p=new Uint8Array(b),l=new Int8Array(b),n=new Uint16Array(b),j=new Int16Array(b),o=new Uint32Array(b),k=new Int32Array(b),f=new Float32Array(b),"undefined"!=typeof Float64Array&&null!==Float64Array&&(g=new Float64Array(b)),m=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0],c.UnderflowError=function(a){function b(){this.name="AV.UnderflowError"}return e(b,a),b}(Error),a.fromBuffer=function(a){var b;return b=new c.BufferList,b.append(a),new c.Stream(b)},a.prototype.copy=function(){var a;return a=new c.Stream(this.list.copy()),a.localOffset=this.localOffset,a.offset=this.offset,a},a.prototype.available=function(a){return a<=this.list.availableBytes-this.localOffset},a.prototype.remainingBytes=function(){return this.list.availableBytes-this.localOffset},a.prototype.advance=function(a){if(!this.available(a))throw new c.UnderflowError;for(this.localOffset+=a,this.offset+=a;this.list.first&&this.localOffset>=this.list.first.length;)this.localOffset-=this.list.first.length,this.list.advance();return this},a.prototype.rewind=function(a){if(a>this.offset)throw new c.UnderflowError;for(this.list.first||(this.list.rewind(),this.localOffset=this.list.first.length),this.localOffset-=a,this.offset-=a;this.list.first.prev&&this.localOffset<0;)this.list.rewind(),this.localOffset+=this.list.first.length;return this},a.prototype.seek=function(a){return a>this.offset?this.advance(a-this.offset):a<this.offset?this.rewind(this.offset-a):void 0},a.prototype.readUInt8=function(){var a;if(!this.available(1))throw new c.UnderflowError;return a=this.list.first.data[this.localOffset],this.localOffset+=1,this.offset+=1,this.localOffset===this.list.first.length&&(this.localOffset=0,this.list.advance()),a},a.prototype.peekUInt8=function(a){var b;if(null==a&&(a=0),!this.available(a+1))throw new c.UnderflowError;for(a=this.localOffset+a,b=this.list.first;b;){if(b.length>a)return b.data[a];a-=b.length,b=b.next}return 0},a.prototype.read=function(a,b){var c,d,e,f;if(null==b&&(b=!1),b===m)for(c=d=0;a>d;c=d+=1)p[c]=this.readUInt8();else for(c=e=f=a-1;e>=0;c=e+=-1)p[c]=this.readUInt8()},a.prototype.peek=function(a,b,c){var d,e,f;if(null==c&&(c=!1),c===m)for(d=e=0;a>e;d=e+=1)p[d]=this.peekUInt8(b+d);else for(d=f=0;a>f;d=f+=1)p[a-d-1]=this.peekUInt8(b+d)},a.prototype.readInt8=function(){return this.read(1),l[0]},a.prototype.peekInt8=function(a){return null==a&&(a=0),this.peek(1,a),l[0]},a.prototype.readUInt16=function(a){return this.read(2,a),n[0]},a.prototype.peekUInt16=function(a,b){return null==a&&(a=0),this.peek(2,a,b),n[0]},a.prototype.readInt16=function(a){return this.read(2,a),j[0]},a.prototype.peekInt16=function(a,b){return null==a&&(a=0),this.peek(2,a,b),j[0]},a.prototype.readUInt24=function(a){return a?this.readUInt16(!0)+(this.readUInt8()<<16):(this.readUInt16()<<8)+this.readUInt8()},a.prototype.peekUInt24=function(a,b){return null==a&&(a=0),b?this.peekUInt16(a,!0)+(this.peekUInt8(a+2)<<16):(this.peekUInt16(a)<<8)+this.peekUInt8(a+2)},a.prototype.readInt24=function(a){return a?this.readUInt16(!0)+(this.readInt8()<<16):(this.readInt16()<<8)+this.readUInt8()},a.prototype.peekInt24=function(a,b){return null==a&&(a=0),b?this.peekUInt16(a,!0)+(this.peekInt8(a+2)<<16):(this.peekInt16(a)<<8)+this.peekUInt8(a+2)},a.prototype.readUInt32=function(a){return this.read(4,a),o[0]},a.prototype.peekUInt32=function(a,b){return null==a&&(a=0),this.peek(4,a,b),o[0]},a.prototype.readInt32=function(a){return this.read(4,a),k[0]},a.prototype.peekInt32=function(a,b){return null==a&&(a=0),this.peek(4,a,b),k[0]},a.prototype.readFloat32=function(a){return this.read(4,a),f[0]},a.prototype.peekFloat32=function(a,b){return null==a&&(a=0),this.peek(4,a,b),f[0]},a.prototype.readFloat64=function(a){return this.read(8,a),g?g[0]:h()},h=function(){var a,b,c,d,e,f;return d=o[0],c=o[1],c&&2147483648!==c?(f=1-2*(c>>>31),a=c>>>20&2047,b=1048575&c,2047===a?b?0/0:1/0*f:(a-=1023,e=(1048576|b)*Math.pow(2,a-20),e+=d*Math.pow(2,a-52),f*e)):0},a.prototype.peekFloat64=function(a,b){return null==a&&(a=0),this.peek(8,a,b),g?g[0]:h()},a.prototype.readFloat80=function(a){return this.read(10,a),i()},i=function(){var a,b,c,d,e,f,g;return d=o[0],e=o[1],a=p[9],b=p[8],g=1-2*(a>>>7),c=(127&a)<<8|b,0===c&&0===e&&0===d?0:32767===c?0===e&&0===d?1/0*g:0/0:(c-=16383,f=e*Math.pow(2,c-31),f+=d*Math.pow(2,c-63),g*f)},a.prototype.peekFloat80=function(a,b){return null==a&&(a=0),this.peek(10,a,b),i()},a.prototype.readBuffer=function(a){var b,d,e,f;for(d=c.Buffer.allocate(a),e=d.data,b=f=0;a>f;b=f+=1)e[b]=this.readUInt8();return d},a.prototype.peekBuffer=function(a,b){var d,e,f,g;for(null==a&&(a=0),e=c.Buffer.allocate(b),f=e.data,d=g=0;b>g;d=g+=1)f[d]=this.peekUInt8(a+d);return e},a.prototype.readSingleBuffer=function(a){var b;return b=this.list.first.slice(this.localOffset,a),this.advance(b.length),b},a.prototype.peekSingleBuffer=function(a,b){var c;return c=this.list.first.slice(this.localOffset+a,b)},a.prototype.readString=function(a,b){return null==b&&(b="ascii"),d.call(this,0,a,b,!0)},a.prototype.peekString=function(a,b,c){return null==a&&(a=0),null==c&&(c="ascii"),d.call(this,a,b,c,!1)},d=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q;switch(c=c.toLowerCase(),m=null===b?0:-1,null==b&&(b=1/0),k=a+b,o="",c){case"ascii":case"latin1":for(;k>a&&(j=this.peekUInt8(a++))!==m;)o+=String.fromCharCode(j);break;case"utf8":case"utf-8":for(;k>a&&(e=this.peekUInt8(a++))!==m;)0===(128&e)?o+=String.fromCharCode(e):192===(224&e)?(f=63&this.peekUInt8(a++),o+=String.fromCharCode((31&e)<<6|f)):224===(240&e)?(f=63&this.peekUInt8(a++),g=63&this.peekUInt8(a++),o+=String.fromCharCode((15&e)<<12|f<<6|g)):240===(248&e)&&(f=63&this.peekUInt8(a++),g=63&this.peekUInt8(a++),h=63&this.peekUInt8(a++),n=((15&e)<<18|f<<12|g<<6|h)-65536,o+=String.fromCharCode(55296+(n>>10),56320+(1023&n)));break;case"utf16-be":case"utf16be":case"utf16le":case"utf16-le":case"utf16bom":case"utf16-bom":switch(c){case"utf16be":case"utf16-be":l=!1;break;case"utf16le":case"utf16-le":l=!0;break;case"utf16bom":case"utf16-bom":if(2>b||(i=this.peekUInt16(a))===m)return d&&this.advance(a+=2),o;l=65534===i,a+=2}for(;k>a&&(p=this.peekUInt16(a,l))!==m;)if(a+=2,55296>p||p>57343)o+=String.fromCharCode(p);else{if(p>56319)throw new Error("Invalid utf16 sequence.");if(q=this.peekUInt16(a,l),56320>q||q>57343)throw new Error("Invalid utf16 sequence.");o+=String.fromCharCode(p,q),a+=2}p===m&&(a+=2);break;default:throw new Error("Unknown encoding: "+c)}return d&&this.advance(a),o},a}(),c.Bitstream=function(){function a(a){this.stream=a,this.bitPosition=0}return a.prototype.copy=function(){var a;return a=new c.Bitstream(this.stream.copy()),a.bitPosition=this.bitPosition,a},a.prototype.offset=function(){return 8*this.stream.offset+this.bitPosition},a.prototype.available=function(a){return this.stream.available((a+8-this.bitPosition)/8)},a.prototype.advance=function(a){var b;return b=this.bitPosition+a,this.stream.advance(b>>3),this.bitPosition=7&b},a.prototype.rewind=function(a){var b;return b=this.bitPosition-a,this.stream.rewind(Math.abs(b>>3)),this.bitPosition=7&b},a.prototype.seek=function(a){var b;return b=this.offset(),a>b?this.advance(a-b):b>a?this.rewind(b-a):void 0},a.prototype.align=function(){return 0!==this.bitPosition?(this.bitPosition=0,this.stream.advance(1)):void 0},a.prototype.read=function(a,b){var c,d,e,f,g,h,i;if(0===a)return 0;if(i=a+this.bitPosition,8>=i)c=(this.stream.peekUInt8()<<this.bitPosition&255)>>>8-a;else if(16>=i)c=(this.stream.peekUInt16()<<this.bitPosition&65535)>>>16-a;else if(24>=i)c=(this.stream.peekUInt24()<<this.bitPosition&16777215)>>>24-a;else if(32>=i)c=this.stream.peekUInt32()<<this.bitPosition>>>32-a;else{if(!(40>=i))throw new Error("Too many bits!");d=4294967296*this.stream.peekUInt8(0),e=this.stream.peekUInt8(1)<<24>>>0,f=this.stream.peekUInt8(2)<<16,g=this.stream.peekUInt8(3)<<8,h=this.stream.peekUInt8(4),c=d+e+f+g+h,c%=Math.pow(2,40-this.bitPosition),c=Math.floor(c/Math.pow(2,40-this.bitPosition-a))}return b&&(32>i?c>>>a-1&&(c=-1*((1<<a>>>0)-c)):c/Math.pow(2,a-1)|0&&(c=-1*(Math.pow(2,a)-c))),this.advance(a),c},a.prototype.peek=function(a,b){var c,d,e,f,g,h,i;if(0===a)return 0;if(i=a+this.bitPosition,8>=i)c=(this.stream.peekUInt8()<<this.bitPosition&255)>>>8-a;else if(16>=i)c=(this.stream.peekUInt16()<<this.bitPosition&65535)>>>16-a;else if(24>=i)c=(this.stream.peekUInt24()<<this.bitPosition&16777215)>>>24-a;else if(32>=i)c=this.stream.peekUInt32()<<this.bitPosition>>>32-a;else{if(!(40>=i))throw new Error("Too many bits!");d=4294967296*this.stream.peekUInt8(0),e=this.stream.peekUInt8(1)<<24>>>0,f=this.stream.peekUInt8(2)<<16,g=this.stream.peekUInt8(3)<<8,h=this.stream.peekUInt8(4),c=d+e+f+g+h,c%=Math.pow(2,40-this.bitPosition),c=Math.floor(c/Math.pow(2,40-this.bitPosition-a))}return b&&(32>i?c>>>a-1&&(c=-1*((1<<a>>>0)-c)):c/Math.pow(2,a-1)|0&&(c=-1*(Math.pow(2,a)-c))),c},a.prototype.readLSB=function(a,b){var c,d;if(0===a)return 0;if(a>40)throw new Error("Too many bits!");return d=a+this.bitPosition,c=this.stream.peekUInt8(0)>>>this.bitPosition,d>8&&(c|=this.stream.peekUInt8(1)<<8-this.bitPosition),d>16&&(c|=this.stream.peekUInt8(2)<<16-this.bitPosition),d>24&&(c+=this.stream.peekUInt8(3)<<24-this.bitPosition>>>0),d>32&&(c+=this.stream.peekUInt8(4)*Math.pow(2,32-this.bitPosition)),d>=32?c%=Math.pow(2,a):c&=(1<<a)-1,b&&(32>d?c>>>a-1&&(c=-1*((1<<a>>>0)-c)):c/Math.pow(2,a-1)|0&&(c=-1*(Math.pow(2,a)-c))),this.advance(a),c},a.prototype.peekLSB=function(a,b){var c,d;if(0===a)return 0;if(a>40)throw new Error("Too many bits!");return d=a+this.bitPosition,c=this.stream.peekUInt8(0)>>>this.bitPosition,d>8&&(c|=this.stream.peekUInt8(1)<<8-this.bitPosition),d>16&&(c|=this.stream.peekUInt8(2)<<16-this.bitPosition),d>24&&(c+=this.stream.peekUInt8(3)<<24-this.bitPosition>>>0),d>32&&(c+=this.stream.peekUInt8(4)*Math.pow(2,32-this.bitPosition)),d>=32?c%=Math.pow(2,a):c&=(1<<a)-1,b&&(32>d?c>>>a-1&&(c=-1*((1<<a>>>0)-c)):c/Math.pow(2,a-1)|0&&(c=-1*(Math.pow(2,a)-c))),c},a}();var d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g=[].slice;c.EventEmitter=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.on=function(a,b){var c,d,e;return null==(d=this.events)&&(this.events={}),null==(e=(c=this.events)[a])&&(c[a]=[]),this.events[a].push(b)},b.prototype.off=function(a,b){var c,d;if(null!=(d=this.events)?d[a]:void 0)return c=this.events[a].indexOf(b),~c?this.events[a].splice(c,1):void 0},b.prototype.once=function(a,b){var c;return this.on(a,c=function(){return this.off(a,c),b.apply(this,arguments)})},b.prototype.emit=function(){var a,b,c,d,e,f,h;if(b=arguments[0],a=2<=arguments.length?g.call(arguments,1):[],null!=(f=this.events)?f[b]:void 0)for(h=this.events[b].slice(),d=0,e=h.length;e>d;d++)c=h[d],c.apply(this,a)},b}(c.Base);var d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c.Demuxer=function(a){function b(a,b){var d,e,f=this;d=new c.BufferList,d.append(b),this.stream=new c.Stream(d),e=!1,a.on("data",function(a){return e=!0,d.append(a),f.readChunk(a)}),a.on("error",function(a){return f.emit("error",a)}),a.on("end",function(){return e||f.readChunk(b),f.emit("end")}),this.seekPoints=[],this.init()}var d;return e(b,a),b.probe=function(){return!1},b.prototype.init=function(){},b.prototype.readChunk=function(){},b.prototype.addSeekPoint=function(a,b){var c;return c=this.searchTimestamp(b),this.seekPoints.splice(c,0,{offset:a,timestamp:b})},b.prototype.searchTimestamp=function(a){var b,c,d,e;if(c=0,b=this.seekPoints.length,b>0&&this.seekPoints[b-1].timestamp<a)return b;for(;b>c;)d=c+b>>1,e=this.seekPoints[d].timestamp,a>e?c=d+1:e>=a&&(b=d);return b>this.seekPoints.length&&(b=this.seekPoints.length),b},b.prototype.seek=function(a){var b,c;return this.format&&this.format.framesPerPacket>0&&this.format.bytesPerPacket>0?c={timestamp:a,offset:this.format.bytesPerPacket*a/this.format.framesPerPacket}:(b=this.searchTimestamp(a),this.seekPoints[b])},d=[],b.register=function(a){return d.push(a)},b.find=function(a){var b,e,f,g;for(e=c.Stream.fromBuffer(a),f=0,g=d.length;g>f;f++)if(b=d[f],b.probe(e))return b;return null},b}(c.EventEmitter);var d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c.Decoder=function(a){function b(a,b){var d,e=this;this.demuxer=a,this.format=b,d=new c.BufferList,this.stream=new c.Stream(d),this.bitstream=new c.Bitstream(this.stream),this.receivedFinalBuffer=!1,this.waiting=!1,this.demuxer.on("cookie",function(a){try{return e.setCookie(a)}catch(b){return e.emit("error",b)}}),this.demuxer.on("data",function(a){return d.append(a),e.waiting?e.decode():void 0}),this.demuxer.on("end",function(){return e.receivedFinalBuffer=!0,e.waiting?e.decode():void 0}),this.init()}var d;return e(b,a),b.prototype.init=function(){},b.prototype.setCookie=function(){},b.prototype.readChunk=function(){},b.prototype.decode=function(){var a,b;this.waiting=!1,a=this.bitstream.offset();try{b=this.readChunk()}catch(d){if(!(d instanceof c.UnderflowError))return this.emit("error",d),!1}return b?(this.emit("data",b),!0):(this.receivedFinalBuffer?this.emit("end"):(this.bitstream.seek(a),this.waiting=!0),!1)},b.prototype.seek=function(a){var b;return b=this.demuxer.seek(a),this.stream.seek(b.offset),b.timestamp},d={},b.register=function(a,b){return d[a]=b},b.find=function(a){return d[a]||null},b}(c.EventEmitter);var d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c.Queue=function(a){function b(a){var c=this;this.asset=a,this.write=function(){return b.prototype.write.apply(c,arguments)},this.readyMark=64,this.finished=!1,this.buffering=!0,this.ended=!1,this.buffers=[],this.asset.on("data",this.write),this.asset.on("end",function(){return c.ended=!0}),this.asset.decodePacket()}return e(b,a),b.prototype.write=function(a){return a&&this.buffers.push(a),this.buffering?this.buffers.length>=this.readyMark||this.ended?(this.buffering=!1,this.emit("ready")):this.asset.decodePacket():void 0},b.prototype.read=function(){return 0===this.buffers.length?null:(this.asset.decodePacket(),this.buffers.shift())},b.prototype.reset=function(){return this.buffers.length=0,this.buffering=!0,this.asset.decodePacket()},b}(c.EventEmitter);var d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c.AudioDevice=function(a){function b(a,c){var d=this;this.sampleRate=a,this.channels=c,this.updateTime=function(){return b.prototype.updateTime.apply(d,arguments)},this.playing=!1,this.currentTime=0,this._lastTime=0}var d;return e(b,a),b.prototype.start=function(){var a,b=this;if(!this.playing)return this.playing=!0,null==(a=this.device)&&(this.device=c.AudioDevice.create(this.sampleRate,this.channels)),this._lastTime=this.device.getDeviceTime(),this._timer=setInterval(this.updateTime,200),this.device.on("refill",this.refill=function(a){return b.emit("refill",a)})},b.prototype.stop=function(){return this.playing?(this.playing=!1,this.device.off("refill",this.refill),clearInterval(this._timer)):void 0},b.prototype.destroy=function(){return this.stop(),this.device.destroy()},b.prototype.seek=function(a){return this.currentTime=a,this.playing&&(this._lastTime=this.device.getDeviceTime()),this.emit("timeUpdate",this.currentTime)},b.prototype.updateTime=function(){var a;return a=this.device.getDeviceTime(),this.currentTime+=(a-this._lastTime)/this.device.sampleRate*1e3|0,this._lastTime=a,this.emit("timeUpdate",this.currentTime)},d=[],b.register=function(a){return d.push(a)},b.create=function(a,b){var c,e,f;for(e=0,f=d.length;f>e;e++)if(c=d[e],c.supported)return new c(a,b);return null},b}(c.EventEmitter);var d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c.Asset=function(a){function b(a){var c=this;this.source=a,this._decode=function(){return b.prototype._decode.apply(c,arguments)},this.findDecoder=function(a){return c.format=a,b.prototype.findDecoder.apply(c,arguments)},this.probe=function(){return b.prototype.probe.apply(c,arguments)},this.buffered=0,this.duration=null,this.format=null,this.metadata=null,this.active=!1,this.demuxer=null,this.decoder=null,this.source.once("data",this.probe),this.source.on("error",function(a){return c.emit("error",a),c.stop()}),this.source.on("progress",function(a){return c.buffered=a,c.emit("buffer",c.buffered)})}return e(b,a),b.fromURL=function(a){var b;return b=new c.HTTPSource(a),new c.Asset(b)},b.fromFile=function(a){var b;return b=new c.FileSource(a),new c.Asset(b)},b.prototype.start=function(a){var b;if(!this.active)return null!=a&&(this.shouldDecode=a),null==(b=this.shouldDecode)&&(this.shouldDecode=!0),this.active=!0,this.source.start(),this.decoder&&this.shouldDecode?this._decode():void 0},b.prototype.stop=function(){return this.active?(this.active=!1,this.source.pause()):void 0},b.prototype.get=function(a,b){var c=this;if("format"===a||"duration"===a||"metadata"===a)return null!=this[a]?b(this[a]):(this.once(a,function(a){return c.stop(),b(a)}),this.start())},b.prototype.decodePacket=function(){return this.decoder.decode()},b.prototype.probe=function(a){var b,d=this;if(this.active)return(b=c.Demuxer.find(a))?(this.demuxer=new b(this.source,a),this.demuxer.on("format",this.findDecoder),this.demuxer.on("duration",function(a){return d.duration=a,d.emit("duration",d.duration)}),this.demuxer.on("metadata",function(a){return d.metadata=a,d.emit("metadata",d.metadata)}),this.demuxer.on("error",function(a){return d.emit("error",a),d.stop()})):this.emit("error","A demuxer for this container was not found.")},b.prototype.findDecoder=function(a){var b,d=this;return this.format=a,this.active?(this.emit("format",this.format),(b=c.Decoder.find(this.format.formatID))?(this.decoder=new b(this.demuxer,this.format),this.decoder.on("data",function(a){return d.emit("data",a)}),this.decoder.on("error",function(a){return d.emit("error",a),d.stop()}),this.decoder.on("end",function(){return d.emit("end")}),this.emit("decodeStart"),this.shouldDecode?this._decode():void 0):this.emit("error","A decoder for "+this.format.formatID+" was not found.")):void 0},b.prototype._decode=function(){for(;this.decoder.decode()&&this.active;);return this.active?this.decoder.once("data",this._decode):void 0},b}(c.EventEmitter);var d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c.Player=function(a){function b(a){var d=this;this.asset=a,this.startPlaying=function(){return b.prototype.startPlaying.apply(d,arguments)},this.playing=!1,this.buffered=0,this.currentTime=0,this.duration=0,this.volume=100,this.pan=0,this.metadata={},this.filters=[new c.VolumeFilter(this,"volume"),new c.BalanceFilter(this,"pan")],this.asset.on("buffer",function(a){return d.buffered=a,d.emit("buffer",d.buffered)}),this.asset.on("decodeStart",function(){return d.queue=new c.Queue(d.asset),d.queue.once("ready",d.startPlaying)}),this.asset.on("format",function(a){return d.format=a,d.emit("format",d.format)}),this.asset.on("metadata",function(a){return d.metadata=a,d.emit("metadata",d.metadata)}),this.asset.on("duration",function(a){return d.duration=a,d.emit("duration",d.duration)}),this.asset.on("error",function(a){return d.emit("error",a)})}return e(b,a),b.fromURL=function(a){var b;return b=c.Asset.fromURL(a),new c.Player(b)},b.fromFile=function(a){var b;return b=c.Asset.fromFile(a),new c.Player(b)},b.prototype.preload=function(){return this.asset?(this.startedPreloading=!0,this.asset.start(!1)):void 0},b.prototype.play=function(){var a;if(!this.playing)return this.startedPreloading||this.preload(),this.playing=!0,null!=(a=this.device)?a.start():void 0},b.prototype.pause=function(){var a;if(this.playing)return this.playing=!1,null!=(a=this.device)?a.stop():void 0},b.prototype.togglePlayback=function(){return this.playing?this.pause():this.play()},b.prototype.stop=function(){var a;return this.pause(),this.asset.stop(),null!=(a=this.device)?a.destroy():void 0},b.prototype.seek=function(a){var b,c=this;return null!=(b=this.device)&&b.stop(),this.queue.once("ready",function(){var a,b;return null!=(a=c.device)&&a.seek(c.currentTime),c.playing?null!=(b=c.device)?b.start():void 0:void 0}),a=a/1e3*this.format.sampleRate,a=this.asset.decoder.seek(a),this.currentTime=a/this.format.sampleRate*1e3|0,this.queue.reset(),this.currentTime},b.prototype.startPlaying=function(){var a,b,d,e=this;return b=this.queue.read(),d=0,a=this.format.floatingPoint?1:Math.pow(2,this.format.bitsPerChannel-1),this.device=new c.AudioDevice(this.format.sampleRate,this.format.channelsPerFrame),this.device.on("timeUpdate",function(a){return e.currentTime=a,e.emit("progress",e.currentTime)}),this.refill=function(c){var f,g,h,i,j,k,l,m;if(e.playing){for(b||(b=e.queue.read(),d=0),f=0;b&&f<c.length;){for(i=Math.min(b.length-d,c.length-f),h=j=0;i>j;h=j+=1)c[f++]=b[d++]/a;d===b.length&&(b=e.queue.read(),d=0)}for(m=e.filters,k=0,l=m.length;l>k;k++)g=m[k],g.process(c);b||(e.asset.ended?(e.currentTime=e.duration,e.emit("progress",e.currentTime),e.emit("end"),e.stop()):e.device.stop())}},this.device.on("refill",this.refill),this.playing&&this.device.start(),this.emit("ready")},b}(c.EventEmitter),a.prototype.initialize=function(){if(!(this.fromSampleRate>0&&this.toSampleRate>0&&this.channels>0))throw new Error("Invalid settings specified for the resampler.");this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1):(this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.initializeBuffers())},a.prototype.compileLinearInterpolationFunction=function(){for(var a="var bufferLength = buffer.length;  var outLength = this.outputBufferSize;  if ((bufferLength % "+this.channels+") == 0) {    if (bufferLength > 0) {      var ratioWeight = this.ratioWeight;      var weight = this.lastWeight;      var firstWeight = 0;      var secondWeight = 0;      var sourceOffset = 0;      var outputOffset = 0;      var outputBuffer = this.outputBuffer;      for (; weight < 1; weight += ratioWeight) {        secondWeight = weight % 1;        firstWeight = 1 - secondWeight;",b=0;b<this.channels;++b)a+="outputBuffer[outputOffset++] = (this.lastOutput["+b+"] * firstWeight) + (buffer["+b+"] * secondWeight);";a+="}      weight -= 1;      for (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; outputOffset < outLength && sourceOffset < bufferLength;) {        secondWeight = weight % 1;        firstWeight = 1 - secondWeight;";for(var b=0;b<this.channels;++b)a+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(b>0?" + "+b:"")+"] * firstWeight) + (buffer[sourceOffset + "+(this.channels+b)+"] * secondWeight);";a+="weight += ratioWeight;        sourceOffset = Math.floor(weight) * "+this.channels+";      }";for(var b=0;b<this.channels;++b)a+="this.lastOutput["+b+"] = buffer[sourceOffset++];";a+='this.lastWeight = weight % 1;      return this.bufferSlice(outputOffset);    }    else {      return (this.noReturn) ? 0 : [];    }  }  else {    throw(new Error("Buffer was of incorrect sample length."));  }',this.resampler=Function("buffer",a)},a.prototype.compileMultiTapFunction=function(){for(var a="var bufferLength = buffer.length;  var outLength = this.outputBufferSize;  if ((bufferLength % "+this.channels+") == 0) {    if (bufferLength > 0) {      var ratioWeight = this.ratioWeight;      var weight = 0;",b=0;b<this.channels;++b)a+="var output"+b+" = 0;";for(a+="var actualPosition = 0;      var amountToNext = 0;      var alreadyProcessedTail = !this.tailExists;      this.tailExists = false;      var outputBuffer = this.outputBuffer;      var outputOffset = 0;      var currentPosition = 0;      do {        if (alreadyProcessedTail) {          weight = ratioWeight;",b=0;b<this.channels;++b)a+="output"+b+" = 0;";for(a+="}        else {          weight = this.lastWeight;",b=0;b<this.channels;++b)a+="output"+b+" = this.lastOutput["+b+"];";for(a+="alreadyProcessedTail = true;        }        while (weight > 0 && actualPosition < bufferLength) {          amountToNext = 1 + actualPosition - currentPosition;          if (weight >= amountToNext) {",b=0;b<this.channels;++b)a+="output"+b+" += buffer[actualPosition++] * amountToNext;";for(a+="currentPosition = actualPosition;            weight -= amountToNext;          }          else {",b=0;b<this.channels;++b)a+="output"+b+" += buffer[actualPosition"+(b>0?" + "+b:"")+"] * weight;";for(a+="currentPosition += weight;            weight = 0;            break;          }        }        if (weight == 0) {",b=0;b<this.channels;++b)a+="outputBuffer[outputOffset++] = output"+b+" / ratioWeight;";for(a+="}        else {          this.lastWeight = weight;",b=0;b<this.channels;++b)a+="this.lastOutput["+b+"] = output"+b+";";a+='this.tailExists = true;          break;        }      } while (actualPosition < bufferLength && outputOffset < outLength);      return this.bufferSlice(outputOffset);    }    else {      return (this.noReturn) ? 0 : [];    }  }  else {    throw(new Error("Buffer was of incorrect sample length."));  }',this.resampler=Function("buffer",a)},a.prototype.bypassResampler=function(a){return this.noReturn?(this.outputBuffer=a,a.length):a},a.prototype.bufferSlice=function(a){if(this.noReturn)return a;try{return this.outputBuffer.subarray(0,a)}catch(b){try{return this.outputBuffer.length=a,this.outputBuffer}catch(b){return this.outputBuffer.slice(0,a)}}},a.prototype.initializeBuffers=function(){try{this.outputBuffer=new Float32Array(this.outputBufferSize),this.lastOutput=new Float32Array(this.channels)}catch(a){this.outputBuffer=[],this.lastOutput=[]}};var h,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};h=function(d){function f(b,c){var d=this;this.sampleRate=b,this.channels=c,this.refill=function(){return f.prototype.refill.apply(d,arguments)},this.context=null!=h?h:h=new g,this.deviceSampleRate=this.context.sampleRate,this.bufferSize=Math.ceil(4096/(this.deviceSampleRate/this.sampleRate)*this.channels),this.bufferSize+=this.bufferSize%this.channels,this.deviceSampleRate!==this.sampleRate&&(this.resampler=new a(this.sampleRate,this.deviceSampleRate,this.channels,4096*this.channels)),this.node=this.context.createJavaScriptNode(4096,this.channels,this.channels),this.node.onaudioprocess=this.refill,this.node.connect(this.context.destination)}var g,h;return e(f,d),c.AudioDevice.register(f),g=b.AudioContext||b.webkitAudioContext,f.supported="function"==typeof(null!=g?g.prototype.createJavaScriptNode:void 0),h=null,f.prototype.refill=function(a){var b,c,d,e,f,g,h,i,j,k;for(g=a.outputBuffer,b=g.numberOfChannels,c=new Array(b),e=h=0;b>h;e=h+=1)c[e]=g.getChannelData(e);for(d=new Float32Array(this.bufferSize),this.emit("refill",d),this.resampler&&(d=this.resampler.resampler(d)),e=i=0,k=g.length;k>i;e=i+=1)for(f=j=0;b>j;f=j+=1)c[f][e]=d[e*b+f]},f.prototype.destroy=function(){return this.node.disconnect(0)},f.prototype.getDeviceTime=function(){return this.context.currentTime*this.sampleRate},f}(c.EventEmitter);var i,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};i=function(a){function b(a,c){var e=this;this.sampleRate=a,this.channels=c,this.refill=function(){return b.prototype.refill.apply(e,arguments)},this.audio=new Audio,this.audio.mozSetup(this.channels,this.sampleRate),this.writePosition=0,this.prebufferSize=this.sampleRate/2,this.tail=null,this.timer=d(this.refill,100)}var d,f;return e(b,a),c.AudioDevice.register(b),b.supported="undefined"!=typeof Audio&&null!==Audio&&"mozWriteAudio"in new Audio,b.prototype.refill=function(){var a,b,c,d;this.tail&&(d=this.audio.mozWriteAudio(this.tail),this.writePosition+=d,this.tail=this.writePosition<this.tail.length?this.tail.subarray(d):null),c=this.audio.mozCurrentSampleOffset(),a=c+this.prebufferSize-this.writePosition,a>0&&(b=new Float32Array(a),this.emit("refill",b),d=this.audio.mozWriteAudio(b),d<b.length&&(this.tail=b.subarray(d)),this.writePosition+=d)
},b.prototype.destroy=function(){return f(this.timer)},b.prototype.getDeviceTime=function(){return this.audio.mozCurrentSampleOffset()/this.channels},d=function(a,b){var d,e;return d=c.Buffer.makeBlobURL("setInterval(function() { postMessage('ping'); }, "+b+");"),null==d?setInterval(a,b):(e=new Worker(d),e.onmessage=a,e.url=d,e)},f=function(a){return a.terminate?(a.terminate(),URL.revokeObjectURL(a.url)):clearInterval(a)},b}(c.EventEmitter),c.Filter=function(){function a(a,b){a&&b&&Object.defineProperty(this,"value",{get:function(){return a[b]}})}return a.prototype.process=function(){},a}();var d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c.VolumeFilter=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.process=function(a){var b,c,d,e;if(!(this.value>=100))for(c=Math.max(0,Math.min(100,this.value))/100,b=d=0,e=a.length;e>d;b=d+=1)a[b]*=c},b}(c.Filter);var d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c.BalanceFilter=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.process=function(a){var b,c,d,e;if(0!==this.value)for(c=Math.max(-50,Math.min(50,this.value)),b=d=0,e=a.length;e>d;b=d+=2)a[b]*=Math.min(1,(50-c)/50),a[b+1]*=Math.min(1,(50+c)/50)},b}(c.Filter);var j,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};j=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),c.Demuxer.register(b),b.probe=function(a){return"caff"===a.peekString(0,4)},b.prototype.readChunk=function(){var a,b,c,d,e,f,g,h,i,j,l,m,n,o;if(!this.format&&this.stream.available(64)){if("caff"!==this.stream.readString(4))return this.emit("error","Invalid CAF, does not begin with 'caff'");if(this.stream.advance(4),"desc"!==this.stream.readString(4))return this.emit("error","Invalid CAF, 'caff' is not followed by 'desc'");if(0!==this.stream.readUInt32()||32!==this.stream.readUInt32())return this.emit("error","Invalid 'desc' size, should be 32");this.format={},this.format.sampleRate=this.stream.readFloat64(),this.format.formatID=this.stream.readString(4),e=this.stream.readUInt32(),"lpcm"===this.format.formatID&&(this.format.floatingPoint=Boolean(1&e),this.format.littleEndian=Boolean(2&e)),this.format.bytesPerPacket=this.stream.readUInt32(),this.format.framesPerPacket=this.stream.readUInt32(),this.format.channelsPerFrame=this.stream.readUInt32(),this.format.bitsPerChannel=this.stream.readUInt32(),this.emit("format",this.format)}for(;this.stream.available(1);){if(!this.headerCache&&(this.headerCache={type:this.stream.readString(4),oversize:0!==this.stream.readUInt32(),size:this.stream.readUInt32()},this.headerCache.oversize))return this.emit("error","Holy Shit, an oversized file, not supported in JS");switch(this.headerCache.type){case"kuki":this.stream.available(this.headerCache.size)&&("aac "===this.format.formatID?(i=this.stream.offset+this.headerCache.size,(c=k.readEsds(this.stream))&&this.emit("cookie",c),this.stream.seek(i)):(a=this.stream.readBuffer(this.headerCache.size),this.emit("cookie",a)),this.headerCache=null);break;case"pakt":if(this.stream.available(this.headerCache.size)){if(0!==this.stream.readUInt32())return this.emit("error","Sizes greater than 32 bits are not supported.");if(this.numPackets=this.stream.readUInt32(),0!==this.stream.readUInt32())return this.emit("error","Sizes greater than 32 bits are not supported.");for(this.numFrames=this.stream.readUInt32(),this.primingFrames=this.stream.readUInt32(),this.remainderFrames=this.stream.readUInt32(),this.emit("duration",this.numFrames/this.format.sampleRate*1e3|0),this.sentDuration=!0,b=0,j=0,f=m=0,o=this.numPackets;o>m;f=m+=1)this.addSeekPoint(b,j),b+=this.format.bytesPerPacket||k.readDescrLen(this.stream),j+=this.format.framesPerPacket||k.readDescrLen(this.stream);this.headerCache=null}break;case"info":for(d=this.stream.readUInt32(),h={},f=n=0;d>=0?d>n:n>d;f=d>=0?++n:--n)g=this.stream.readString(null),l=this.stream.readString(null),h[g]=l;this.emit("metadata",h),this.headerCache=null;break;case"data":this.sentFirstDataChunk||(this.stream.advance(4),this.headerCache.size-=4,0===this.format.bytesPerPacket||this.sentDuration||(this.numFrames=this.headerCache.size/this.format.bytesPerPacket,this.emit("duration",this.numFrames/this.format.sampleRate*1e3|0)),this.sentFirstDataChunk=!0),a=this.stream.readSingleBuffer(this.headerCache.size),this.headerCache.size-=a.length,this.emit("data",a),this.headerCache.size<=0&&(this.headerCache=null);break;default:this.stream.available(this.headerCache.size)&&(this.stream.advance(this.headerCache.size),this.headerCache=null)}}},b}(c.Demuxer);var k,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};k=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}var d,g,h,i,j,k,l,m,n,o,p;return e(b,a),c.Demuxer.register(b),g=["M4A ","M4P ","M4B ","M4V ","isom","mp42","qt  "],b.probe=function(a){var b;return"ftyp"===a.peekString(4,4)&&(b=a.peekString(8,4),f.call(g,b)>=0)},b.prototype.init=function(){return this.atoms=[],this.offsets=[],this.track=null,this.tracks=[]},j={},l={},i=function(a,b){var c,d,e,f,g,h;for(c=[],g=a.split(".").slice(0,-1),e=0,f=g.length;f>e;e++)d=g[e],c.push(d),l[c.join(".")]=!0;return null==(h=j[a])&&(j[a]={}),j[a].fn=b},h=function(a,b){var c;return null==(c=j[a])&&(j[a]={}),j[a].after=b},b.prototype.readChunk=function(){var a,b,c;for(this["break"]=!1;this.stream.available(1)&&!this["break"];){if(!this.readHeaders){if(!this.stream.available(8))return;if(this.len=this.stream.readUInt32()-8,this.type=this.stream.readString(4),0===this.len)continue;this.atoms.push(this.type),this.offsets.push(this.stream.offset+this.len),this.readHeaders=!0}if(b=this.atoms.join("."),a=j[b],null!=a?a.fn:void 0){if(!this.stream.available(this.len)&&"mdat"!==b)return;a.fn.call(this),b in l&&(this.readHeaders=!1)}else if(b in l)this.readHeaders=!1;else{if(!this.stream.available(this.len))return;this.stream.advance(this.len)}for(;this.stream.offset>=this.offsets[this.offsets.length-1];)a=j[this.atoms.join(".")],(null!=a?a.after:void 0)&&a.after.call(this),c=this.atoms.pop(),this.offsets.pop(),this.readHeaders=!1}},i("ftyp",function(){var a;return a=this.stream.readString(4),f.call(g,a)<0?this.emit("error","Not a valid M4A file."):this.stream.advance(this.len-4)}),i("moov.trak",function(){return this.track={},this.tracks.push(this.track)}),i("moov.trak.tkhd",function(){return this.stream.advance(4),this.stream.advance(8),this.track.id=this.stream.readUInt32(),this.stream.advance(this.len-16)}),i("moov.trak.mdia.hdlr",function(){return this.stream.advance(4),this.stream.advance(4),this.track.type=this.stream.readString(4),this.stream.advance(12),this.stream.advance(this.len-24)}),i("moov.trak.mdia.mdhd",function(){return this.stream.advance(4),this.stream.advance(8),this.track.timeScale=this.stream.readUInt32(),this.track.duration=this.stream.readUInt32(),this.stream.advance(4)}),d={ulaw:8,alaw:8,in24:24,in32:32,fl32:32,fl64:64},i("moov.trak.mdia.minf.stbl.stsd",function(){var a,b,c,e,f;return this.stream.advance(4),b=this.stream.readUInt32(),"soun"!==this.track.type?this.stream.advance(this.len-8):1!==b?this.emit("error","Only expecting one entry in sample description atom!"):(this.stream.advance(4),a=this.track.format={},a.formatID=this.stream.readString(4),this.stream.advance(6),this.stream.advance(2),c=this.stream.readUInt16(),this.stream.advance(6),a.channelsPerFrame=this.stream.readUInt16(),a.bitsPerChannel=this.stream.readUInt16(),this.stream.advance(4),a.sampleRate=this.stream.readUInt16(),this.stream.advance(2),1===c?(a.framesPerPacket=this.stream.readUInt32(),this.stream.advance(4),a.bytesPerFrame=this.stream.readUInt32(),this.stream.advance(4)):0!==c&&this.emit("error","Unknown version in stsd atom"),null!=d[a.formatID]&&(a.bitsPerChannel=d[a.formatID]),a.floatingPoint="fl32"===(e=a.formatID)||"fl64"===e,a.littleEndian="sowt"===a.formatID&&a.bitsPerChannel>8,"twos"===(f=a.formatID)||"sowt"===f||"in24"===f||"in32"===f||"fl32"===f||"fl64"===f||"raw "===f||"NONE"===f?a.formatID="lpcm":void 0)}),i("moov.trak.mdia.minf.stbl.stsd.alac",function(){return this.stream.advance(4),this.track.cookie=this.stream.readBuffer(this.len-4)}),i("moov.trak.mdia.minf.stbl.stsd.esds",function(){var a;return a=this.stream.offset+this.len,this.track.cookie=b.readEsds(this.stream),this.stream.seek(a)}),i("moov.trak.mdia.minf.stbl.stsd.wave.enda",function(){return this.track.format.littleEndian=!!this.stream.readUInt16()}),b.readDescrLen=function(a){var b,c,d;for(d=0,c=4;c--&&(b=a.readUInt8(),d=d<<7|127&b,128&b););return d},b.readEsds=function(a){var c,d,e,f;return a.advance(4),f=a.readUInt8(),e=b.readDescrLen(a),3===f?(a.advance(2),d=a.readUInt8(),128&d&&a.advance(2),64&d&&a.advance(a.readUInt8()),32&d&&a.advance(2)):a.advance(2),f=a.readUInt8(),e=b.readDescrLen(a),4===f&&(c=a.readUInt8(),a.advance(1),a.advance(3),a.advance(4),a.advance(4),f=a.readUInt8(),e=b.readDescrLen(a),5===f)?a.readBuffer(e):null},i("moov.trak.mdia.minf.stbl.stts",function(){var a,b,c;for(this.stream.advance(4),a=this.stream.readUInt32(),this.track.stts=[],b=c=0;a>c;b=c+=1)this.track.stts[b]={count:this.stream.readUInt32(),duration:this.stream.readUInt32()};return this.setupSeekPoints()}),i("moov.trak.mdia.minf.stbl.stsc",function(){var a,b,c;for(this.stream.advance(4),a=this.stream.readUInt32(),this.track.stsc=[],b=c=0;a>c;b=c+=1)this.track.stsc[b]={first:this.stream.readUInt32(),count:this.stream.readUInt32(),id:this.stream.readUInt32()};return this.setupSeekPoints()}),i("moov.trak.mdia.minf.stbl.stsz",function(){var a,b,c;if(this.stream.advance(4),this.track.sampleSize=this.stream.readUInt32(),a=this.stream.readUInt32(),0===this.track.sampleSize&&a>0)for(this.track.sampleSizes=[],b=c=0;a>c;b=c+=1)this.track.sampleSizes[b]=this.stream.readUInt32();return this.setupSeekPoints()}),i("moov.trak.mdia.minf.stbl.stco",function(){var a,b,c;for(this.stream.advance(4),a=this.stream.readUInt32(),this.track.chunkOffsets=[],b=c=0;a>c;b=c+=1)this.track.chunkOffsets[b]=this.stream.readUInt32();return this.setupSeekPoints()}),i("moov.trak.tref.chap",function(){var a,b,c;for(a=this.len>>2,this.track.chapterTracks=[],b=c=0;a>c;b=c+=1)this.track.chapterTracks[b]=this.stream.readUInt32()}),b.prototype.setupSeekPoints=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(null!=this.track.chunkOffsets&&null!=this.track.stsc&&null!=this.track.sampleSize&&null!=this.track.stts){for(g=0,h=0,h=0,i=0,e=0,c=0,j=0,this.track.seekPoints=[],n=this.track.chunkOffsets,p=[],a=k=0,m=n.length;m>k;a=++k){for(d=n[a],b=l=0,o=this.track.stsc[g].count;o>l;b=l+=1)this.track.seekPoints.push({offset:c,position:d,timestamp:j}),f=this.track.sampleSize||this.track.sampleSizes[e++],c+=f,d+=f,j+=this.track.stts[h].duration,h+1<this.track.stts.length&&++i===this.track.stts[h].count&&(i=0,h++);p.push(g+1<this.track.stsc.length&&a+1===this.track.stsc[g+1].first?g++:void 0)}return p}},h("moov",function(){var a,b,c,d;for(null!=this.mdatOffset&&this.stream.seek(this.mdatOffset-8),d=this.tracks,b=0,c=d.length;c>b;b++)if(a=d[b],"soun"===a.type){this.track=a;break}return"soun"!==this.track.type?(this.track=null,this.emit("error","No audio tracks in m4a file.")):(this.emit("format",this.track.format),this.emit("duration",this.track.duration/this.track.timeScale*1e3|0),this.track.cookie&&this.emit("cookie",this.track.cookie),this.seekPoints=this.track.seekPoints)}),i("mdat",function(){var a,b,c,d,e,f,g,h,i;if(!this.startedData){if(null==(i=this.mdatOffset)&&(this.mdatOffset=this.stream.offset),0===this.tracks.length)return a=Math.min(this.stream.remainingBytes(),this.len),this.stream.advance(a),void(this.len-=a);this.chunkIndex=0,this.stscIndex=0,this.sampleIndex=0,this.tailOffset=0,this.tailSamples=0,this.startedData=!0}if(!this.readChapters){if(this.readChapters=this.parseChapters(),this["break"]=!this.readChapters)return;this.stream.seek(this.mdatOffset)}if(e=this.track.chunkOffsets[this.chunkIndex]+this.tailOffset,c=0,!this.stream.available(e-this.stream.offset))return void(this["break"]=!0);for(this.stream.seek(e);this.chunkIndex<this.track.chunkOffsets.length;){for(d=this.track.stsc[this.stscIndex].count-this.tailSamples,b=0,f=h=0;d>h&&(g=this.track.sampleSize||this.track.sampleSizes[this.sampleIndex],this.stream.available(c+g));f=h+=1)c+=g,b+=g,this.sampleIndex++;if(d>f){this.tailOffset+=b,this.tailSamples+=f;break}if(this.chunkIndex++,this.tailOffset=0,this.tailSamples=0,this.stscIndex+1<this.track.stsc.length&&this.chunkIndex+1===this.track.stsc[this.stscIndex+1].first&&this.stscIndex++,e+c!==this.track.chunkOffsets[this.chunkIndex])break}return c>0?(this.emit("data",this.stream.readBuffer(c)),this["break"]=this.chunkIndex===this.track.chunkOffsets.length):this["break"]=!0}),b.prototype.parseChapters=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;if(!((null!=(j=this.track.chapterTracks)?j.length:void 0)>0))return!0;for(b=this.track.chapterTracks[0],k=this.tracks,h=0,i=k.length;i>h&&(g=k[h],g.id!==b);h++);for(g.id!==b&&this.emit("error","Chapter track does not exist."),null==(l=this.chapters)&&(this.chapters=[]);this.chapters.length<g.seekPoints.length;){if(e=g.seekPoints[this.chapters.length],!this.stream.available(e.position-this.stream.offset+32))return!1;if(this.stream.seek(e.position),c=this.stream.readUInt16(),f=null,!this.stream.available(c))return!1;c>2&&(a=this.stream.peekUInt16(),(65279===a||65534===a)&&(f=this.stream.readString(c,"utf16-bom"))),null==f&&(f=this.stream.readString(c,"utf8")),d=null!=(m=null!=(n=g.seekPoints[this.chapters.length+1])?n.timestamp:void 0)?m:g.duration,this.chapters.push({title:f,timestamp:e.timestamp/g.timeScale*1e3|0,duration:(d-e.timestamp)/g.timeScale*1e3|0})}return this.emit("chapters",this.chapters),!0},i("moov.udta.meta",function(){return this.metadata={},this.stream.advance(4)}),h("moov.udta.meta",function(){return this.emit("metadata",this.metadata)}),o=function(a,b,c){return i("moov.udta.meta.ilst."+a+".data",function(){return this.stream.advance(8),this.len-=8,c.call(this,b)})},p=function(a){return this.metadata[a]=this.stream.readString(this.len,"utf8")},o("©alb","album",p),o("©arg","arranger",p),o("©art","artist",p),o("©ART","artist",p),o("aART","albumArtist",p),o("catg","category",p),o("©com","composer",p),o("©cpy","copyright",p),o("cprt","copyright",p),o("©cmt","comments",p),o("©day","releaseDate",p),o("desc","description",p),o("©gen","genre",p),o("©grp","grouping",p),o("©isr","ISRC",p),o("keyw","keywords",p),o("©lab","recordLabel",p),o("ldes","longDescription",p),o("©lyr","lyrics",p),o("©nam","title",p),o("©phg","recordingCopyright",p),o("©prd","producer",p),o("©prf","performers",p),o("purd","purchaseDate",p),o("purl","podcastURL",p),o("©swf","songwriter",p),o("©too","encoder",p),o("©wrt","composer",p),o("covr","coverArt",function(a){return this.metadata[a]=this.stream.readBuffer(this.len)}),n=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychadelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk/Rock","National Folk","Swing","Fast Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Capella","Euro-House","Dance Hall"],o("gnre","genre",function(a){return this.metadata[a]=n[this.stream.readUInt16()-1]}),o("tmpo","tempo",function(a){return this.metadata[a]=this.stream.readUInt16()}),o("rtng","rating",function(a){var b;return b=this.stream.readUInt8(),this.metadata[a]=2===b?"Clean":0!==b?"Explicit":"None"}),m=function(a){return this.stream.advance(2),this.metadata[a]=this.stream.readUInt16()+" of "+this.stream.readUInt16(),this.stream.advance(this.len-6)},o("disk","diskNumber",m),o("trkn","trackNumber",m),k=function(a){return this.metadata[a]=1===this.stream.readUInt8()},o("cpil","compilation",k),o("pcst","podcast",k),o("pgap","gapless",k),b}(c.Demuxer);var l,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};l=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return e(b,a),c.Demuxer.register(b),b.probe=function(a){var b;return"FORM"===a.peekString(0,4)&&("AIFF"===(b=a.peekString(8,4))||"AIFC"===b)},b.prototype.readChunk=function(){var a,b,c,d;if(!this.readStart&&this.stream.available(12)){if("FORM"!==this.stream.readString(4))return this.emit("error","Invalid AIFF.");if(this.fileSize=this.stream.readUInt32(),this.fileType=this.stream.readString(4),this.readStart=!0,"AIFF"!==(d=this.fileType)&&"AIFC"!==d)return this.emit("error","Invalid AIFF.")}for(;this.stream.available(1);){switch(!this.readHeaders&&this.stream.available(8)&&(this.type=this.stream.readString(4),this.len=this.stream.readUInt32()),this.type){case"COMM":if(!this.stream.available(this.len))return;this.format={formatID:"lpcm",channelsPerFrame:this.stream.readUInt16(),sampleCount:this.stream.readUInt32(),bitsPerChannel:this.stream.readUInt16(),sampleRate:this.stream.readFloat80(),framesPerPacket:1,littleEndian:!1,floatingPoint:!1},this.format.bytesPerPacket=this.format.bitsPerChannel/8*this.format.channelsPerFrame,"AIFC"===this.fileType&&(b=this.stream.readString(4),this.format.littleEndian="sowt"===b&&this.format.bitsPerChannel>8,this.format.floatingPoint="fl32"===b||"fl64"===b,("twos"===b||"sowt"===b||"fl32"===b||"fl64"===b||"NONE"===b)&&(b="lpcm"),this.format.formatID=b,this.len-=4),this.stream.advance(this.len-18),this.emit("format",this.format),this.emit("duration",this.format.sampleCount/this.format.sampleRate*1e3|0);break;case"SSND":this.readSSNDHeader&&this.stream.available(4)||(c=this.stream.readUInt32(),this.stream.advance(4),this.stream.advance(c),this.readSSNDHeader=!0),a=this.stream.readSingleBuffer(this.len),this.len-=a.length,this.readHeaders=this.len>0,this.emit("data",a);break;default:if(!this.stream.available(this.len))return;this.stream.advance(this.len)}"SSND"!==this.type&&(this.readHeaders=!1)}},b}(c.Demuxer);var m,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};m=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}var d;return e(b,a),c.Demuxer.register(b),b.probe=function(a){return"RIFF"===a.peekString(0,4)&&"WAVE"===a.peekString(8,4)},d={1:"lpcm",3:"lpcm",6:"alaw",7:"ulaw"},b.prototype.readChunk=function(){var a,b,c;if(!this.readStart&&this.stream.available(12)){if("RIFF"!==this.stream.readString(4))return this.emit("error","Invalid WAV file.");if(this.fileSize=this.stream.readUInt32(!0),this.readStart=!0,"WAVE"!==this.stream.readString(4))return this.emit("error","Invalid WAV file.")}for(;this.stream.available(1);){switch(!this.readHeaders&&this.stream.available(8)&&(this.type=this.stream.readString(4),this.len=this.stream.readUInt32(!0)),this.type){case"fmt ":if(c=this.stream.readUInt16(!0),!(c in d))return this.emit("error","Unsupported format in WAV file.");this.format={formatID:d[c],floatingPoint:3===c,littleEndian:"lpcm"===d[c],channelsPerFrame:this.stream.readUInt16(!0),sampleRate:this.stream.readUInt32(!0),framesPerPacket:1},this.stream.advance(4),this.stream.advance(2),this.format.bitsPerChannel=this.stream.readUInt16(!0),this.format.bytesPerPacket=this.format.bitsPerChannel/8*this.format.channelsPerFrame,this.emit("format",this.format);break;case"data":this.sentDuration||(b=this.format.bitsPerChannel/8,this.emit("duration",this.len/b/this.format.channelsPerFrame/this.format.sampleRate*1e3|0),this.sentDuration=!0),a=this.stream.readSingleBuffer(this.len),this.len-=a.length,this.readHeaders=this.len>0,this.emit("data",a);break;default:if(!this.stream.available(this.len))return;this.stream.advance(this.len)}"data"!==this.type&&(this.readHeaders=!1)}},b}(c.Demuxer);var n,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};n=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}var d,f;return e(b,a),c.Demuxer.register(b),b.probe=function(a){return".snd"===a.peekString(0,4)},d=[8,8,16,24,32,32,64],d[26]=8,f={1:"ulaw",27:"alaw"},b.prototype.readChunk=function(){var a,b,c,e;if(!this.readHeader&&this.stream.available(24)){if(".snd"!==this.stream.readString(4))return this.emit("error","Invalid AU file.");if(e=this.stream.readUInt32(),b=this.stream.readUInt32(),c=this.stream.readUInt32(),this.format={formatID:f[c]||"lpcm",littleEndian:!1,floatingPoint:6===c||7===c,bitsPerChannel:d[c-1],sampleRate:this.stream.readUInt32(),channelsPerFrame:this.stream.readUInt32(),framesPerPacket:1},null==this.format.bitsPerChannel)return this.emit("error","Unsupported encoding in AU file.");this.format.bytesPerPacket=this.format.bitsPerChannel/8*this.format.channelsPerFrame,4294967295!==b&&(a=this.format.bitsPerChannel/8,this.emit("duration",b/a/this.format.channelsPerFrame/this.format.sampleRate*1e3|0)),this.emit("format",this.format),this.readHeader=!0}if(this.readHeader)for(;this.stream.available(1);)this.emit("data",this.stream.readSingleBuffer(this.stream.remainingBytes()))},b}(c.Demuxer);var o,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};o=function(a){function b(){var a=this;return this.readChunk=function(){return b.prototype.readChunk.apply(a,arguments)},b.__super__.constructor.apply(this,arguments)}return e(b,a),c.Decoder.register("lpcm",b),b.prototype.readChunk=function(){var a,b,c,d,e,f,g,h,i,j,k,l;if(f=this.stream,c=this.format.littleEndian,a=Math.min(4096,f.remainingBytes()),e=a/(this.format.bitsPerChannel/8)|0,a<this.format.bitsPerChannel/8)return null;if(this.format.floatingPoint)switch(this.format.bitsPerChannel){case 32:for(d=new Float32Array(e),b=g=0;e>g;b=g+=1)d[b]=f.readFloat32(c);break;case 64:for(d=new Float64Array(e),b=h=0;e>h;b=h+=1)d[b]=f.readFloat64(c);break;default:throw new Error("Unsupported bit depth.")}else switch(this.format.bitsPerChannel){case 8:for(d=new Int8Array(e),b=i=0;e>i;b=i+=1)d[b]=f.readInt8();break;case 16:for(d=new Int16Array(e),b=j=0;e>j;b=j+=1)d[b]=f.readInt16(c);break;case 24:for(d=new Int32Array(e),b=k=0;e>k;b=k+=1)d[b]=f.readInt24(c);break;case 32:for(d=new Int32Array(e),b=l=0;e>l;b=l+=1)d[b]=f.readInt32(c);break;default:throw new Error("Unsupported bit depth.")}return d},b}(c.Decoder);var p,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};p=function(a){function b(){var a=this;return this.readChunk=function(){return b.prototype.readChunk.apply(a,arguments)},b.__super__.constructor.apply(this,arguments)}var d,f,g,h,i;return e(b,a),c.Decoder.register("ulaw",b),c.Decoder.register("alaw",b),i=128,f=15,h=4,g=112,d=132,b.prototype.init=function(){var a,b,c,e,j,k,l;if(this.format.bitsPerChannel=16,this.table=e=new Int16Array(256),"ulaw"===this.format.formatID)for(a=k=0;256>k;a=++k)j=~a,c=((j&f)<<3)+d,c<<=(j&g)>>>h,e[a]=j&i?d-c:c-d;else for(a=l=0;256>l;a=++l)j=85^a,c=j&f,b=(j&g)>>>h,c=b?c+c+1+32<<b+2:c+c+1<<3,e[a]=j&i?c:-c},b.prototype.readChunk=function(){var a,b,c,d,e,f;if(d=this.stream,e=this.table,c=Math.min(4096,this.stream.remainingBytes()),0!==c){for(b=new Int16Array(c),a=f=0;c>f;a=f+=1)b[a]=e[d.readUInt8()];return b}},b}(c.Decoder);var d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c.HTTPSource=function(a){function b(a){this.url=a,this.chunkSize=1<<20,this.inflight=!1,this.reset()}return e(b,a),b.prototype.start=function(){var a=this;return this.length&&!this.inflight?this.loop():(this.inflight=!0,this.xhr=new XMLHttpRequest,this.xhr.onload=function(){return a.length=parseInt(a.xhr.getResponseHeader("Content-Length")),a.inflight=!1,a.loop()},this.xhr.onerror=function(b){return a.pause(),a.emit("error",b)},this.xhr.onabort=function(){return a.inflight=!1},this.xhr.open("HEAD",this.url,!0),this.xhr.send(null))},b.prototype.loop=function(){var a,b=this;return this.inflight||!this.length?this.emit("error","Something is wrong in HTTPSource.loop"):(this.inflight=!0,this.xhr=new XMLHttpRequest,this.xhr.onload=function(){var a,d,e,f,g,h;if(b.xhr.response)a=new Uint8Array(b.xhr.response);else for(f=b.xhr.responseText,a=new Uint8Array(f.length),e=g=0,h=f.length;h>=0?h>g:g>h;e=h>=0?++g:--g)a[e]=255&f.charCodeAt(e);return d=new c.Buffer(a),b.offset+=d.length,b.emit("data",d),b.offset>=b.length&&b.emit("end"),b.inflight=!1,b.offset>=b.length?void 0:b.loop()},this.xhr.onprogress=function(a){return b.emit("progress",(b.offset+a.loaded)/b.length*100)},this.xhr.onerror=function(a){return b.emit("error",a),b.pause()},this.xhr.onabort=function(){return b.inflight=!1},this.xhr.open("GET",this.url,!0),this.xhr.responseType="arraybuffer",a=Math.min(this.offset+this.chunkSize,this.length),this.xhr.setRequestHeader("Range","bytes="+this.offset+"-"+a),this.xhr.overrideMimeType("text/plain; charset=x-user-defined"),this.xhr.send(null))},b.prototype.pause=function(){var a;return this.inflight=!1,null!=(a=this.xhr)?a.abort():void 0},b.prototype.reset=function(){return this.pause(),this.offset=0},b}(c.EventEmitter);var d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};return c.FileSource=function(a){function b(a){return this.file=a,"undefined"==typeof FileReader||null===FileReader?this.emit("error","This browser does not have FileReader support."):(this.offset=0,this.length=this.file.size,void(this.chunkSize=1<<20))}return e(b,a),b.prototype.start=function(){var a=this;return this.reader&&!this.active?this.loop():(this.reader=new FileReader,this.active=!0,this.reader.onload=function(b){var d;return d=new c.Buffer(new Uint8Array(b.target.result)),a.offset+=d.length,a.emit("data",d),a.active=!1,a.offset<a.length?a.loop():void 0},this.reader.onloadend=function(){return a.offset===a.length?(a.emit("end"),a.reader=null):void 0},this.reader.onerror=function(b){return a.emit("error",b)},this.reader.onprogress=function(b){return a.emit("progress",(a.offset+b.loaded)/a.length*100)},this.loop())},b.prototype.loop=function(){var a,b,c;return this.active=!0,this.file[c="slice"]||this.file[c="webkitSlice"]||this.file[c="mozSlice"],b=Math.min(this.offset+this.chunkSize,this.length),a=this.file[c](this.offset,b),this.reader.readAsArrayBuffer(a)},b.prototype.pause=function(){var a;return this.active=!1,null!=(a=this.reader)?a.abort():void 0},b.prototype.reset=function(){return this.pause(),this.offset=0},b}(c.EventEmitter),b.AV=c}(),function(){AV.Demuxer.extend(function(){AV.Demuxer.register(this),this.probe=function(a){return"fLaC"===a.peekString(0,4)};const a=0,b=4,c=6,d=34;this.prototype.readChunk=function(){var e=this.stream;if(!this.readHeader&&e.available(4)){if("fLaC"!==e.readString(4))return this.emit("error","Invalid FLAC file.");this.readHeader=!0}for(;e.available(1)&&!this.last;){if(!this.readBlockHeaders){var f=e.readUInt8();this.last=128===(128&f),this.type=127&f,this.size=e.readUInt24()}if(!this.foundStreamInfo&&this.type!==a)return this.emit("error","STREAMINFO must be the first block");if(!e.available(this.size))return;switch(this.type){case a:if(this.foundStreamInfo)return this.emit("error","STREAMINFO can only occur once.");if(this.size!==d)return this.emit("error","STREAMINFO size is wrong.");this.foundStreamInfo=!0;var g=new AV.Bitstream(e),h={minBlockSize:g.read(16),maxBlockSize:g.read(16),minFrameSize:g.read(24),maxFrameSize:g.read(24)};this.format={formatID:"flac",sampleRate:g.read(20),channelsPerFrame:g.read(3)+1,bitsPerChannel:g.read(5)+1},this.emit("format",this.format),this.emit("cookie",h);var i=g.read(36);this.emit("duration",i/this.format.sampleRate*1e3|0),e.advance(16),this.readBlockHeaders=!1;break;case b:this.metadata||(this.metadata={});var j=e.readUInt32(!0);this.metadata.vendor=e.readString(j);for(var k=e.readUInt32(!0),l=0;k>l;l++){j=e.readUInt32(!0);var m=e.readString(j,"utf8"),n=m.indexOf("=");this.metadata[m.slice(0,n).toLowerCase()]=m.slice(n+1)}break;case c:var o=e.readUInt32();if(3!==o)e.advance(this.size-4);else{var p=e.readUInt32(),q=(e.readString(p),e.readUInt32()),k=(e.readString(q),e.readUInt32(),e.readUInt32(),e.readUInt32(),e.readUInt32(),e.readUInt32()),r=e.readBuffer(k);this.metadata||(this.metadata={}),this.metadata.coverArt=r}break;default:e.advance(this.size),this.readBlockHeaders=!1}this.last&&this.metadata&&this.emit("metadata",this.metadata)}for(;e.available(1)&&this.last;){var s=e.readSingleBuffer(e.remainingBytes());this.emit("data",s)}}}),AV.Decoder.extend(function(){function a(a){for(var b=0,c=0;;){if(c=a>>>24)break;if(b+=8,c=a>>>16,255&c)break;if(b+=8,c=a>>>8,255&c)break;if(b+=8,c=a,255&c)break;return b+=8}return 240&c?c>>>=4:b+=4,8&c?b:4&c?b+1:2&c?b+2:1&c?b+3:b+4}AV.Decoder.register("flac",this),this.prototype.setCookie=function(a){this.cookie=a,this.decoded=[];for(var b=0;b<this.format.channelsPerFrame;b++)this.decoded[b]=new Int32Array(a.maxBlockSize)};const b=new Int16Array([0,192,576,1152,2304,4608,0,0,256,512,1024,2048,4096,8192,16384,32768]),c=new Int32Array([0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0]),d=new Int8Array([0,8,12,0,16,20,24,0]),e=8,f=0,g=8,h=9,i=10;this.prototype.readChunk=function(){var a=this.bitstream;if(a.available(32)){if(32764!==(32767&a.read(15)))throw new Error("Invalid sync code");var j=(a.read(1),a.read(4)),k=a.read(4),l=a.read(4),m=a.read(3);a.advance(1),this.chMode=l;var n;if(e>l)n=l+1,this.chMode=f;else{if(!(i>=l))throw new Error("Invalid channel mode");n=2}if(n!==this.format.channelsPerFrame)throw new Error("Switching channel layout mid-stream not supported.");if(3===m||7===m)throw new Error("Invalid sample size code");if(this.bps=d[m],this.bps!==this.format.bitsPerChannel)throw new Error("Switching bits per sample mid-stream not supported.");var o,p;this.bps>16?(o=32-this.bps,p=!0):(o=16-this.bps,p=!1);for(var q=0;1===a.read(1);)q++;for(var r=a.read(7-q);q>1;q--)a.advance(2),r=r<<6|a.read(6);
if(0===j)throw new Error("Reserved blocksize code");this.blockSize=6===j?a.read(8)+1:7===j?a.read(16)+1:b[j];var s;if(12>k)s=c[k];else if(12===k)s=1e3*a.read(8);else if(13===k)s=a.read(16);else{if(14!==k)throw new Error("Invalid sample rate code");s=10*a.read(16)}a.advance(8);for(var t=0;n>t;t++)this.decodeSubframe(t);a.align(),a.advance(16);var u=new ArrayBuffer(this.blockSize*n*this.bps/8),v=p?new Int32Array(u):new Int16Array(u),w=this.blockSize,x=this.decoded,y=0;switch(this.chMode){case f:for(var z=0;w>z;z++)for(var t=0;n>t;t++)v[y++]=x[t][z]<<o;break;case g:for(var t=0;w>t;t++){var A=x[0][t],B=x[1][t];v[y++]=A<<o,v[y++]=A-B<<o}break;case h:for(var t=0;w>t;t++){var A=x[0][t],B=x[1][t];v[y++]=A+B<<o,v[y++]=B<<o}break;case i:for(var t=0;w>t;t++){var A=x[0][t],B=x[1][t];A-=B>>1,v[y++]=A+B<<o,v[y++]=A<<o}}return v}},this.prototype.decodeSubframe=function(a){var b=0,c=this.bitstream,d=this.blockSize,e=this.decoded;if(this.curr_bps=this.bps,0===a?this.chMode===h&&this.curr_bps++:(this.chMode===g||this.chMode===i)&&this.curr_bps++,c.read(1))throw new Error("Invalid subframe padding");var f=c.read(6);if(c.read(1)){for(b=1;!c.read(1);)b++;this.curr_bps-=b}if(this.curr_bps>32)throw new Error("decorrelated bit depth > 32 ("+this.curr_bps+")");if(0===f)for(var j=c.read(this.curr_bps,!0),k=0;d>k;k++)e[a][k]=j;else if(1===f)for(var l=this.curr_bps,k=0;d>k;k++)e[a][k]=c.read(l,!0);else if(f>=8&&12>=f)this.decode_subframe_fixed(a,-9&f);else{if(!(f>=32))throw new Error("Invalid coding type");this.decode_subframe_lpc(a,(-33&f)+1)}if(b)for(var k=0;d>k;k++)e[a][k]<<=b},this.prototype.decode_subframe_fixed=function(a,b){for(var c=this.decoded[a],d=this.bitstream,e=this.curr_bps,f=0;b>f;f++)c[f]=d.read(e,!0);this.decode_residuals(a,b);var g=0,h=0,i=0,j=0;switch(b>0&&(g=c[b-1]),b>1&&(h=g-c[b-2]),b>2&&(i=h-c[b-2]+c[b-3]),b>3&&(j=i-c[b-2]+2*c[b-3]-c[b-4]),b){case 0:break;case 1:case 2:case 3:case 4:for(var k=new Int32Array([g,h,i,j]),l=this.blockSize,f=b;l>f;f++){k[b-1]+=c[f];for(var m=b-2;m>=0;m--)k[m]+=k[m+1];c[f]=k[0]}break;default:throw new Error("Invalid Predictor Order "+b)}},this.prototype.decode_subframe_lpc=function(a,b){for(var c=this.bitstream,d=this.decoded[a],e=this.curr_bps,f=this.blockSize,g=0;b>g;g++)d[g]=c.read(e,!0);var h=c.read(4)+1;if(16===h)throw new Error("Invalid coefficient precision");var i=c.read(5,!0);if(0>i)throw new Error("Negative qlevel, maybe buggy stream");for(var j=new Int32Array(32),g=0;b>g;g++)j[g]=c.read(h,!0);if(this.decode_residuals(a,b),this.bps>16)throw new Error("no 64-bit integers in JS, could probably use doubles though");for(var g=b;f-1>g;g+=2){for(var k,l=d[g-b],m=0,n=0,o=b-1;o>0;o--)k=j[o],m+=k*l,l=d[g-o],n+=k*l;k=j[0],m+=k*l,l=d[g]+=m>>i,n+=k*l,d[g+1]+=n>>i}if(f>g){for(var p=0,o=0;b>o;o++)p+=j[o]*d[g-o-1];d[g]+=p>>i}};const j=32767;this.prototype.decode_residuals=function(a,b){var c=this.bitstream,d=c.read(2);if(d>1)throw new Error("Illegal residual coding method "+d);var e=c.read(4),f=this.blockSize>>>e;if(b>f)throw new Error("Invalid predictor order "+b+" > "+f);for(var g=this.decoded[a],h=b,i=b,k=0;1<<e>k;k++){var l=c.read(0===d?4:5);if(l===(0===d?15:31))for(l=c.read(5);f>i;i++)g[h++]=c.read(l,!0);else for(;f>i;i++)g[h++]=this.golomb(l,j,0);i=0}};this.prototype.golomb=function(b,c,d){var e=this.bitstream,f=e.bitPosition,g=e.peek(32-f)<<f,h=0,i=31-a(1|g);if(i-b>=7&&c>32-i)g>>>=i-b,g+=30-i<<b,e.advance(32+b-i),h=g;else{for(var j=0;0===e.read(1);j++)g=e.peek(32-f)<<f;c-1>j?(g=b?e.read(b):0,h=g+(j<<b)):j===c-1?(g=e.read(d),h=g+1):h=-1}return h>>1^-(1&h)}})}();